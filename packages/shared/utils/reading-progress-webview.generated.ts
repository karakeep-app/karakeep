// This file is auto-generated by scripts/build-webview-js.ts
// Do not edit manually. Run: pnpm --filter @karakeep/shared generate:webview-js
// Sources: reading-progress-webview-src.ts, reading-progress-core.ts

/**
 * WebView-compatible JavaScript for reading progress tracking.
 * Designed for React Native WebView injection.
 * Uses window-level scrolling only (no container scrolling detection).
 *
 * Exposes these functions on the __readingProgress global:
 * - getReadingPosition(container)
 * - scrollToReadingPosition(container, offset, behavior, anchor)
 */
export const READING_PROGRESS_WEBVIEW_JS =
  '"use strict";var __readingProgress=(()=>{var T=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var N=(t,e)=>{for(var r in e)T(t,r,{get:e[r],enumerable:!0})},M=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let l of C(e))!k.call(t,l)&&l!==r&&T(t,l,{get:()=>e[l],enumerable:!(o=w(e,l))||o.enumerable});return t};var O=t=>M(T({},"__esModule",{value:!0}),t);var y={};N(y,{getReadingPosition:()=>I,scrollToReadingPosition:()=>A});var E=["p","h1","h2","h3","h4","h5","h6","li","blockquote"],b=E.join(", "),x=50,_=5;function d(t){return t.replace(/[\\n\\r\\t]+/g," ").replace(/\\s+/g," ").trim()}function H(t){return d(t).length}function P(t,e,r){var i,n,s,h;let o=Array.from(t.querySelectorAll(b));if(o.length===0)return null;let l=H((i=t.textContent)!=null?i:"");if(r){let{scrollTop:u,scrollHeight:m,clientHeight:S}=r;if(u+S>=m-_){let R=o[o.length-1],L=R?d((n=R.textContent)!=null?n:"").slice(0,x):"";return{offset:l,anchor:L,percent:100}}}let c=null;for(let u of o){let m=u.getBoundingClientRect();if(m.top>=e){c=u;break}if(m.top<e&&m.bottom>e){c=u;break}}if(!c)return null;let g=d((s=c.textContent)!=null?s:"").slice(0,x),p=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null),f=0,a;for(;a=p.nextNode();){if(c.contains(a)){let u=l>0?Math.min(100,Math.max(0,Math.round(f/l*100))):0;return{offset:f,anchor:g,percent:u}}f+=H((h=a.textContent)!=null?h:"")}return null}function A(t,e,r="smooth",o){var p,f;if(e<=0)return!1;if(o){let a=Array.from(t.querySelectorAll(b)),i=null,n=o.slice(0,20);for(let s of a){let h=d((p=s.textContent)!=null?p:"").slice(0,x);if(h===o)return s.scrollIntoView({behavior:r,block:"start"}),!0;!i&&o.length>=20&&h.startsWith(n)&&(i=s)}if(i)return i.scrollIntoView({behavior:r,block:"start"}),!0}let l=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null),c=0,g;for(;g=l.nextNode();){let a=(f=g.textContent)!=null?f:"",i=H(a);if(i!==0){if(c+i>=e){let n=g.parentElement;for(;n&&n!==t;){let s=n.tagName.toLowerCase();if(E.includes(s))break;n=n.parentElement}if((!n||n===t)&&(n=g.parentElement),n)return n.scrollIntoView({behavior:r,block:"start"}),!0;break}c+=i}}return!1}function I(t){let e={scrollTop:window.scrollY,scrollHeight:document.body.scrollHeight,clientHeight:window.innerHeight};return P(t,0,e)}return O(y);})();\n';
