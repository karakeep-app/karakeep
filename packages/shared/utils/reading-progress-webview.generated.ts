// This file is auto-generated by scripts/build-webview-js.ts
// Do not edit manually. Run: pnpm --filter @karakeep/shared generate:webview-js
// Sources: reading-progress-webview-src.ts, reading-progress-core.ts

/**
 * WebView-compatible JavaScript for reading progress tracking.
 * Designed for React Native WebView injection.
 * Uses window-level scrolling only (no container scrolling detection).
 *
 * Exposes these functions on the __readingProgress global:
 * - getReadingPosition(container)
 * - scrollToReadingPosition(container, offset, behavior, anchor)
 */
export const READING_PROGRESS_WEBVIEW_JS =
  '"use strict";var __readingProgress=(()=>{var T=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var _=Object.getOwnPropertyNames;var w=Object.prototype.hasOwnProperty;var O=(t,e)=>{for(var r in e)T(t,r,{get:e[r],enumerable:!0})},k=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let l of _(e))!w.call(t,l)&&l!==r&&T(t,l,{get:()=>e[l],enumerable:!(o=C(e,l))||o.enumerable});return t};var M=t=>k(T({},"__esModule",{value:!0}),t);var y={};O(y,{getReadingPosition:()=>I,scrollToReadingPosition:()=>b});var H=["p","h1","h2","h3","h4","h5","h6","li","blockquote"],S=H.join(", "),x=50,N=5;function d(t){return t.replace(/[\\n\\r\\t]+/g," ").replace(/\\s+/g," ").trim()}function R(t){return d(t).length}function L(t,e,r){var i,n,s,h;let o=Array.from(t.querySelectorAll(S));if(o.length===0)return null;let l=R((i=t.textContent)!=null?i:"");if(r){let{scrollTop:u,scrollHeight:p,clientHeight:A}=r;if(u+A>=p-N){let E=o[o.length-1],P=E?d((n=E.textContent)!=null?n:"").slice(0,x):"";return{offset:l,anchor:P,percent:100}}}let c=null;for(let u of o){let p=u.getBoundingClientRect();if(p.top>=e){c=u;break}if(p.top<e&&p.bottom>e){c=u;break}}if(!c)return null;let g=d((s=c.textContent)!=null?s:"").slice(0,x),m=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null),f=0,a;for(;a=m.nextNode();){if(c.contains(a)){let u=l>0?Math.min(100,Math.max(0,Math.round(f/l*100))):0;return{offset:f,anchor:g,percent:u}}f+=R((h=a.textContent)!=null?h:"")}return null}function b(t,e,r="smooth",o){var m,f;if(e<=0)return!1;if(o){let a=Array.from(t.querySelectorAll(S)),i=null,n=o.slice(0,20);for(let s of a){let h=d((m=s.textContent)!=null?m:"").slice(0,x);if(h===o)return s.scrollIntoView({behavior:r,block:"start"}),!0;!i&&o.length>=20&&h.startsWith(n)&&(i=s)}if(i)return i.scrollIntoView({behavior:r,block:"start"}),!0}let l=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null),c=0,g;for(;g=l.nextNode();){let a=(f=g.textContent)!=null?f:"",i=R(a);if(i!==0){if(c+i>=e){let n=g.parentElement;for(;n&&n!==t;){let s=n.tagName.toLowerCase();if(H.includes(s))break;n=n.parentElement}if((!n||n===t)&&(n=g.parentElement),n)return n.scrollIntoView({behavior:r,block:"start"}),!0;break}c+=i}}return!1}function I(t){let e={scrollTop:window.scrollY,scrollHeight:document.body.scrollHeight,clientHeight:window.innerHeight};return L(t,0,e)}return M(y);})();\n';
