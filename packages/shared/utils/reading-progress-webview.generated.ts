// This file is auto-generated by scripts/build-webview-js.ts
// Do not edit manually. Run: pnpm --filter @karakeep/shared generate:webview-js
// Sources: reading-progress-webview-src.ts, reading-progress-core.ts

/**
 * WebView-compatible JavaScript for reading progress tracking.
 * Designed for React Native WebView injection.
 * Uses window-level scrolling only (no container scrolling detection).
 *
 * Exposes these functions on the __readingProgress global:
 * - normalizeText(text)
 * - normalizeTextLength(text)
 * - extractAnchorText(element)
 * - findParagraphByAnchor(container, anchor)
 * - getReadingPosition(container)
 * - scrollToReadingPosition(container, offset, behavior, anchor)
 */
export const READING_PROGRESS_WEBVIEW_JS =
  '"use strict";var __readingProgress=(()=>{var h=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var P=Object.prototype.hasOwnProperty;var L=(e,t)=>{for(var n in t)h(e,n,{get:t[n],enumerable:!0})},N=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let l of R(t))!P.call(e,l)&&l!==n&&h(e,l,{get:()=>t[l],enumerable:!(r=E(t,l))||r.enumerable});return e};var b=e=>N(h({},"__esModule",{value:!0}),e);var S={};L(S,{extractAnchorText:()=>u,findParagraphByAnchor:()=>x,getReadingPosition:()=>H,normalizeText:()=>f,normalizeTextLength:()=>p,scrollToReadingPosition:()=>A});var T=["p","h1","h2","h3","h4","h5","h6","li","blockquote"],m=T.join(", "),k=50;function f(e){return e.replace(/[\\n\\r\\t]+/g," ").replace(/\\s+/g," ").trim()}function p(e){return f(e).length}function u(e){var n;let t=(n=e.textContent)!=null?n:"";return f(t).slice(0,k)}function x(e,t){if(!t)return null;let n=Array.from(e.querySelectorAll(m));for(let r of n)if(u(r)===t)return r;for(let r of n)if(u(r).slice(0,20)===t.slice(0,20)&&t.length>=20)return r;return null}function A(e,t,n="smooth",r){var s;if(t<=0)return!1;if(r){let i=x(e,r);if(i)return i.scrollIntoView({behavior:n,block:"start"}),!0}let l=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null),g=0,a;for(;a=l.nextNode();){let i=(s=a.textContent)!=null?s:"",c=p(i);if(c!==0){if(g+c>=t){let o=a.parentElement;for(;o&&o!==e;){let d=o.tagName.toLowerCase();if(T.includes(d))break;o=o.parentElement}if((!o||o===e)&&(o=a.parentElement),o)return o.scrollIntoView({behavior:n,block:"start"}),!0;break}g+=c}}return!1}function H(e){var i;let t=e.querySelectorAll(m);if(t.length===0)return null;let n=0,r=null;for(let c of t){let o=c.getBoundingClientRect();if(o.top>=n){r=c;break}if(o.top<n&&o.bottom>n){r=c;break}}if(!r)return null;let l=u(r),g=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null),a=0,s;for(;s=g.nextNode();){if(r.contains(s))return{offset:a,anchor:l};a+=p((i=s.textContent)!=null?i:"")}return null}return b(S);})();\n';
